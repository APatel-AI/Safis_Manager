<!DOCTYPE html>
<html>
<head>
    <title>Safis Extension Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        #console-log {
            background: #000;
            color: #00ff00;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>Safis Extension Test Page</h1>
    
    <div class="test-section">
        <h2>Quick Test</h2>
        <p>This is a test page for the Safis extension. Use this page to test if the extension works.</p>
        <button onclick="testExtension()">Click Safis Extension Icon Now</button>
        <p><small>After clicking the button above, click the Safis extension icon in your Chrome toolbar.</small></p>
    </div>

    <div class="test-section">
        <h2>Extension Status</h2>
        <div id="extension-status" class="status warning">Click the button above and then the extension icon to test</div>
    </div>

    <div class="test-section">
        <h2>Console Output</h2>
        <p>Console messages from the extension will appear here:</p>
        <div id="console-log">Waiting for extension activation...</div>
        <button onclick="clearConsole()">Clear Console</button>
        <button onclick="addTestBookmark()">Add Test Bookmark</button>
    </div>

    <script>
        let originalConsoleLog = console.log;
        let originalConsoleError = console.error;
        let consoleOutput = document.getElementById('console-log');
        
        // Intercept console messages
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            addToConsole('LOG: ' + args.join(' '));
        };
        
        console.error = function(...args) {
            originalConsoleError.apply(console, args);
            addToConsole('ERROR: ' + args.join(' '));
        };
        
        function addToConsole(message) {
            const timestamp = new Date().toLocaleTimeString();
            consoleOutput.textContent += `[${timestamp}] ${message}\n`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
        
        function clearConsole() {
            consoleOutput.textContent = 'Console cleared...\n';
        }
        
        function testExtension() {
            addToConsole('=== STARTING EXTENSION TEST ===');
            addToConsole('Current URL: ' + window.location.href);
            addToConsole('Page title: ' + document.title);
            addToConsole('Now click the Safis extension icon in your Chrome toolbar...');
            
            document.getElementById('extension-status').className = 'status warning';
            document.getElementById('extension-status').textContent = 'Waiting for extension click...';
            
            // Set up listeners to detect if extension loads
            setTimeout(() => {
                const modal = document.querySelector('#safis-modal');
                if (modal) {
                    document.getElementById('extension-status').className = 'status success';
                    document.getElementById('extension-status').textContent = 'Extension loaded successfully!';
                    addToConsole('SUCCESS: Extension modal found in DOM');
                } else {
                    document.getElementById('extension-status').className = 'status error';
                    document.getElementById('extension-status').textContent = 'Extension modal not found. Check console for errors.';
                    addToConsole('WARNING: No extension modal found after 2 seconds');
                }
            }, 2000);
        }
        
        async function addTestBookmark() {
            try {
                // This will only work if the extension is active
                const response = await chrome.runtime.sendMessage({
                    type: 'ADD_BOOKMARK',
                    title: 'Test Page',
                    url: window.location.href
                });
                
                if (response && response.success) {
                    addToConsole('SUCCESS: Test bookmark added via Chrome API');
                } else {
                    addToConsole('ERROR: Failed to add test bookmark');
                }
            } catch (error) {
                addToConsole('ERROR: Could not communicate with extension: ' + error.message);
            }
        }
        
        // Monitor for extension modal
        setInterval(() => {
            const modal = document.querySelector('#safis-modal');
            if (modal && modal.style.display !== 'none') {
                addToConsole('Extension modal is now visible on page');
            }
        }, 1000);
        
        addToConsole('Test page loaded. Ready for extension testing.');
    </script>
</body>
</html>